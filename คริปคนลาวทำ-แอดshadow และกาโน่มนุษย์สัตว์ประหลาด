local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local hitEvent = ReplicatedStorage:WaitForChild("PracticeHitEvent")

local BALL_NAME = "PracticeBall"
local HIT_FORCE = 80
local MAX_HIT_DISTANCE = 10

local function findBall()
	return Workspace:FindFirstChild(BALL_NAME)
end

local function onPlayerHit(player, originPosition, directionUnit)
	local ball = findBall()
	if not ball or not ball:IsA("BasePart") then return end

	local dist = (ball.Position - originPosition).Magnitude
	if dist > MAX_HIT_DISTANCE then return end

	local bodyVel = Instance.new("BodyVelocity")
	bodyVel.MaxForce = Vector3.new(1e5, 1e5, 1e5)
	bodyVel.Velocity = directionUnit * HIT_FORCE + Vector3.new(0, 10, 0)
	bodyVel.P = 1250
	bodyVel.Parent = ball
	game:GetService("Debris"):AddItem(bodyVel, 0.35)

	print(string.format("[%s] hit the ball (%.2f studs)", player.Name, dist))
end

hitEvent.OnServerEvent:Connect(function(player, originPosition, dirX, dirY, dirZ)
	if typeof(originPosition) ~= "Vector3" then return end
	local dir = Vector3.new(dirX or 0, dirY or 0, dirZ or 0)
	if dir.Magnitude <= 0 then return end
	onPlayerHit(player, originPosition, dir.Unit)
end)
local player = game.Players.LocalPlayer
local mouse = player:GetMouse()
local tool = script.Parent
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local hitEvent = ReplicatedStorage:WaitForChild("PracticeHitEvent")

local lastSwingTime = 0
local SWING_COOLDOWN = 0.12
local SWING_RANGE = 12

local function attemptSwing()
	local now = tick()
	if now - lastSwingTime < SWING_COOLDOWN then return end
	lastSwingTime = now

	local char = player.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local targetPos = mouse.Hit and mouse.Hit.p or (hrp.Position + hrp.CFrame.LookVector * SWING_RANGE)
	local origin = hrp.Position + Vector3.new(0, 2, 0)
	local dir = (targetPos - origin)
	if dir.Magnitude > SWING_RANGE then
		dir = dir.Unit * SWING_RANGE
	end

	hitEvent:FireServer(origin, dir.X, dir.Y, dir.Z)

	local handle = tool:FindFirstChild("Handle")
	if handle then
		local particle = Instance.new("ParticleEmitter")
		particle.Speed = NumberRange.new(3)
		particle.Lifetime = NumberRange.new(0.15)
		particle.Rate = 200
		particle.Parent = handle
		game:GetService("Debris"):AddItem(particle, 0.12)
	end

	pcall(function()
		local playerGui = player:FindFirstChild("PlayerGui")
		if playerGui then
			local statEvent = playerGui:FindFirstChild("PracticeStatEvent")
			if statEvent and statEvent:IsA("BindableEvent") then
				statEvent:Fire(now)
			end
		end
	end)
end

tool.Activated:Connect(attemptSwing)
local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local bindEvent = Instance.new("BindableEvent")
bindEvent.Name = "PracticeStatEvent"
bindEvent.Parent = playerGui

local screenGui = script.Parent
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 260, 0, 120)
frame.Position = UDim2.new(0, 10, 0, 10)
frame.BackgroundTransparency = 0.25
frame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -10, 0, 24)
title.Position = UDim2.new(0, 5, 0, 5)
title.BackgroundTransparency = 1
title.Text = "Practice Stats"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 20
title.TextColor3 = Color3.new(1,1,1)
title.Parent = frame

local hitsLabel = Instance.new("TextLabel")
hitsLabel.Size = UDim2.new(1, -10, 0, 24)
hitsLabel.Position = UDim2.new(0, 5, 0, 35)
hitsLabel.BackgroundTransparency = 1
hitsLabel.Text = "Hits: 0"
hitsLabel.Font = Enum.Font.SourceSans
hitsLabel.TextSize = 18
hitsLabel.TextColor3 = Color3.new(1,1,1)
hitsLabel.Parent = frame

local avgLabel = Instance.new("TextLabel")
avgLabel.Size = UDim2.new(1, -10, 0, 24)
avgLabel.Position = UDim2.new(0, 5, 0, 62)
avgLabel.BackgroundTransparency = 1
avgLabel.Text = "Avg Interval: -"
avgLabel.Font = Enum.Font.SourceSans
avgLabel.TextSize = 16
avgLabel.TextColor3 = Color3.new(1,1,1)
avgLabel.Parent = frame

local hitTimes = {}
local function recordHit(time)
	table.insert(hitTimes, time)
	local hits = #hitTimes
	hitsLabel.Text = "Hits: " .. tostring(hits)
	if hits >= 2 then
		local total = 0
		for i = 2, hits do
			total += (hitTimes[i] - hitTimes[i-1])
		end
		local avg = total / (hits - 1)
		avgLabel.Text = string.format("Avg Interval: %.3f s", avg)
	else
		avgLabel.Text = "Avg Interval: -"
	end
end

bindEvent.Event:Connect(recordHit)
local Workspace = game:GetService("Workspace")
local Debris = game:GetService("Debris")

local BALL_NAME = "PracticeBall"
local spawnPos = Vector3.new(0, 5, 30)

local function createBall()
	local b = Instance.new("Part")
	b.Name = BALL_NAME
	b.Shape = Enum.PartType.Ball
	b.Size = Vector3.new(2,2,2)
	b.Position = spawnPos
	b.BrickColor = BrickColor.new("Bright red")
	b.Anchored = false
	b.Parent = Workspace
	b.Velocity = Vector3.new(0, 0, -12)
	Debris:AddItem(b, 20)
	return b
end

while true do
	createBall()
	wait(4)
end
